<!-- Template pour l'interface d'un plugin -->
<div class="w-full h-full bg-gray-900 p-6" 
     data-controller="plugin-interface"
     hx-ext="json-enc">
    <div class="max-w-4xl mx-auto">
        <!-- En-tête du plugin -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-blue-400">{{ plugin.name }}</h1>
                    <p class="text-gray-400">Version {{ plugin.version }}</p>
                </div>
                <div class="text-gray-400">
                    <p>Auteur: {{ plugin.author }}</p>
                </div>
            </div>
            
            <div class="mb-6">
                <p class="text-gray-400">{{ plugin.description }}</p>
            </div>

            <div class="flex flex-wrap gap-2">
                {% for category in plugin.categories %}
                    <span class="px-3 py-1 bg-gray-700 rounded-full text-sm text-gray-300">{{ category }}</span>
                {% endfor %}
            </div>
        </div>

        <!-- Formulaire des inputs -->
        <form class="bg-gray-800 rounded-lg p-6 mb-6"
              id="plugin-form">
            
            {% for input_name, input_config in plugin.input_types.items() %}
                <div class="mb-4">
                    <label for="{{ input_name }}" class="block text-sm font-medium text-gray-300 mb-2">
                        {{ input_config.label }}
                    </label>

                    {% if input_config.type == "string" %}
                        <input type="text" 
                               id="{{ input_name }}"
                               name="{{ input_name }}"
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="{{ input_config.placeholder|default('') }}"
                               {% if input_config.default %}value="{{ input_config.default }}"{% endif %}>

                    {% elif input_config.type == "select" %}
                        <select id="{{ input_name }}"
                                name="{{ input_name }}"
                                class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            {% for option in input_config.options %}
                                <option value="{{ option }}" {% if option == input_config.default %}selected{% endif %}>
                                    {{ option }}
                                </option>
                            {% endfor %}
                        </select>

                    {% elif input_config.type == "number" %}
                        <input type="number"
                               id="{{ input_name }}"
                               name="{{ input_name }}"
                               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               {% if input_config.min is defined %}min="{{ input_config.min }}"{% endif %}
                               {% if input_config.max is defined %}max="{{ input_config.max }}"{% endif %}
                               {% if input_config.step is defined %}step="{{ input_config.step }}"{% endif %}
                               {% if input_config.default %}value="{{ input_config.default }}"{% endif %}>
                    {% endif %}
                </div>
            {% endfor %}

            <div class="flex justify-end gap-4 mt-6">
                {% if plugin.brute_force %}
                    <button type="button"
                            onclick="executePlugin('bruteforce')"
                            class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        Bruteforce
                    </button>
                {% endif %}
                
                <button type="button"
                        onclick="executePlugin('encode')"
                        class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                    Encoder
                </button>
                
                <button type="button"
                        onclick="executePlugin('decode')"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Décoder
                </button>
            </div>
        </form>

        <!-- Indicateur de chargement -->
        <div id="loading-indicator" class="hidden">
            <div class="flex justify-center items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
            </div>
        </div>

        <!-- Zone de résultat -->
        <div id="plugin-output" class="bg-gray-800 rounded-lg p-6">
            <div class="text-gray-400">Les résultats s'afficheront ici...</div>
        </div>
    </div>
</div>

<script>
function executePlugin(mode) {
    const form = document.getElementById('plugin-form');
    const formData = new FormData(form);
    
    // Convertir FormData en objet JSON
    const jsonData = {};
    formData.forEach((value, key) => {
        jsonData[key] = value;
    });
    jsonData.mode = mode;
    
    // Afficher l'indicateur de chargement
    document.getElementById('loading-indicator').classList.remove('hidden');
    
    // Faire l'appel AJAX avec le bon Content-Type
    fetch('/api/plugins/{{ plugin.name }}/execute', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(jsonData)
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => {
                throw new Error(text || response.statusText);
            });
        }
        return response.text();
    })
    .then(html => {
        document.getElementById('plugin-output').innerHTML = html;
    })
    .catch(error => {
        document.getElementById('plugin-output').innerHTML = 
            '<div class="text-red-500">Erreur lors de l\'exécution du plugin: ' + error.message + '</div>';
    })
    .finally(() => {
        // Cacher l'indicateur de chargement
        document.getElementById('loading-indicator').classList.add('hidden');
    });
}
</script>
